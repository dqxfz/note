<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../js/easyui/themes/default/easyui.css">
    <link rel="stylesheet" href="../js/easyui/themes/icon.css">
    <link rel="stylesheet" href="../css/typora/gitlab.css">
    <link rel="stylesheet" href="../js/highlight/styles/monokai-sublime.css">
    <link rel="stylesheet" href="../css/note.css">
    <script src="../js/highlight/highlight.pack.js"></script>
    <script src="../js/easyui/jquery.min.js"></script>
    <script src="../js/easyui/jquery.easyui.min.js"></script>
    <script src="../js/showdown/dist/showdown.js"></script>
    <script src="../js/websocket/sockjs.min.js"></script>
    <script src="../js/websocket/stomp.js"></script>

    <script src="../js/note/note-folder.js"></script>
    <script src="../js/note/note-content.js"></script>
    <script src="../js/note/note-stomp.js"></script>

</head>
<body>
<script>
    /**
     * 常量
     */
    let errorMessage = '执行失败';
    let sucessMessage = '执行成功';
    let portfolio = '#portfolio';
    let noteContent = '#note_content';
    let nodeDisplay = '#note_display';
    let noteTitle = '#note_title';
    let modelView = '#model_view';
    let modelEdit = '#model_edit';
    let markdown = 'markdown';
    let folder = 'folder';
    let endPointUrl = 'http://' + window.location.host + "/note";
    // 单位为1MB
    let sizeUnit = 1024 * 1024;
    // 限制分段上传大小为10MB
    let snippetSizeThreshold = 5 * sizeUnit;

    /**
     * 后续可能会改变值的变量
     */
    let node_text;
    let current_file;
    // start:正在传输 stop: 停止传输 cancel: 取消传输
    let uploadState = 'stop';
    // 面向消息的stomp对象
    let stomp;
    // 指向当前正在上传的文件对象
    let uploadingFile;
    // 当前是否在上传
    let isUploading = false;
    // 传输到服务器的数据对象
    let noteFile = {
        fatherId: '',
        snippetNum: 0,
        name: '',
        uuidName: '',
        type: '',
        content: ''
    }

    $(function () {
        initPortfolio();
        initContent();
        initStomp();
    });
    function uploadStateChange(checked) {
        uploadState = checked ? 'stop' : 'start';
        if(uploadState == 'start' && !isUploading) {
            transferSnippet(noteFile.snippetNum);
        }
    }
</script>
<div id="portal" class="easyui-layout" style="width:100%;height:100%;">
    <div region="west" split="true" title="导航栏" noheader="true" style="width:15%;">
        <div style="text-align:center;line-height:50px;height:50px;width: 100%;background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%)">
            <p style="padding:0;margin:0;font-weight: bold;font-size: 20px;">导航栏</p>
        </div>
        <div>
            <ul id="portfolio">
            </ul>
        </div>

    </div>
    <div region="center" style="width:85%;" >
        <div style="height:50px;width:100%;background: linear-gradient(to bottom,#EFF5FF 0,#E0ECFF 100%)">
            <div style="height:100%;width: 70%; float: left;padding-left: 10px; font-size: 16px">
                <p id="note_title">日记</p>
            </div>
            <div style="height: 100%;width: 30%;float: right">
                <div style="padding:5px;width:100%;height:100%;">
                    <a href="#" class="btn easyui-linkbutton" iconCls="icon-more" plain="true" onclick="buttonHandler('more')" style="">更多</a>
                    <a href="#" class="btn easyui-linkbutton" plain="true" onclick="buttonHandler('edit')" >编辑</a>
                    <a href="#" class="btn easyui-linkbutton" iconCls="icon-save" plain="true" onclick="buttonHandler('save')">保存</a>
                </div>
            </div>
        </div>
        <div id="model_edit" style="width: 100%;height: 100%;">
            <textarea id="note_content" onkeyup="convert()"></textarea>
            <div id="note_display"></div>
        </div>
        <div id="model_view" style="width: 100%;height: 100%; padding-bottom: 70px">
        </div>
    </div>
</div>

<div id="mm" class="easyui-menu" style="widht:120px" data-options="onClick: menuHandler">
    <div id="add" data-options="iconCls:'icon-add'">
        <span>添加</span>
        <div style="width:150px;">
            <div name="folder"><b>文件夹</b></div>
            <div name="markdown">markdown</div>
        </div>
    </div>
    <div id="rename" data-options="iconCls:'icon-edit',name:'rename'">重命名</div>
    <div id="remove" data-options="iconCls:'icon-remove',name:'remove'">删除</div>
    <div id="upload" data-options="iconCls:'',name:'upload'">上传文件</div>
    <div id="download" data-options="iconCls:'',name:'download'">下载</div>
</div>
<div id="upload_dlg" class="easyui-dialog" data-options="closed:true,closable:false,modal:true,buttons:'#upload_dlg_buttons'"
     style="width: 300px; height: 150px; padding: 10px 20px; text-align: center;">
    <input id="note_file" class="easyui-filebox" style="width:100%" required="true" validType="fileSize[200,'MB']">
    <div id="upload_dlg_buttons">
        <a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-ok'" onclick="uploadFile()">确定</a>
        <a href="javascript:void(0);" class="easyui-linkbutton" style="float: left" data-options="iconCls:'icon-cancel'" onclick="$('#upload_dlg').dialog('close')">取消</a>
    </div>
</div>
<div id="process_dlg" class="easyui-dialog" data-options="closed:true,closable:false,modal:true,buttons:'#process_dlg_buttons',noheader:true"
     style="width: 500px; height: 100px; padding: 10px 10px; text-align: center;">
    <div style="width:100%; height: 100%;">
        <div id="progress_bar" class="easyui-progressbar" data-options="value:0" style="width:80%; height: 100%; float: left"></div>
        <input class="easyui-switchbutton" data-options="onText:'继续',offText:'暂停',onChange:uploadStateChange" style="float: right;height: 100%">
    </div>
    <div id="process_dlg_buttons">
        <a href="javascript:void(0);" class="easyui-linkbutton" data-options="iconCls:'icon-cancel'" onclick="closeFileUpload('cancel')">取消</a>
    </div>
</div>

</body>
</html>